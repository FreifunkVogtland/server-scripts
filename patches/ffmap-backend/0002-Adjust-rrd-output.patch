From: root <root@fermi.chemnitz.freifunk.net>
Date: Mon, 26 Sep 2016 14:01:38 +0200
Subject: [PATCH] Adjust rrd output
---
 lib/GlobalRRD.py | 4 ++--
 lib/NodeRRD.py   | 5 +++--
 lib/rrddb.py     | 4 ++--
 3 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/lib/GlobalRRD.py b/lib/GlobalRRD.py
index 47235f26a12eeb750fddd1c860a39f4946125e9e..f76ff2c3e53bf1797fd16c6a69473fa8125979e1 100644
--- a/lib/GlobalRRD.py
+++ b/lib/GlobalRRD.py
@@ -31,8 +31,8 @@ class GlobalRRD(RRD):
     def graph(self, filename, timeframe):
         args = ["rrdtool", 'graph', filename,
                 '-s', '-' + timeframe,
-                '-w', '800',
-                '-h' '400',
+                '-w', '1000',
+                '-h' '600',
                 'DEF:nodes=' + self.filename + ':nodes:AVERAGE',
                 'LINE1:nodes#F00:nodes\\l',
                 'DEF:clients=' + self.filename + ':clients:AVERAGE',
diff --git a/lib/NodeRRD.py b/lib/NodeRRD.py
index ff2cd588c84421b1580bf653b57fb2fcb87a3a0b..25b806ac737e8b564f6750875049072a7e0dd9b8 100644
--- a/lib/NodeRRD.py
+++ b/lib/NodeRRD.py
@@ -52,9 +52,10 @@ class NodeRRD(RRD):
                 '-l', '0',
                 '-Y',
                 'DEF:clients=' + self.filename + ':clients:AVERAGE',
+                'DEF:upstate=' + self.filename + ':upstate:AVERAGE',
                 'VDEF:maxc=clients,MAXIMUM',
-                'CDEF:c=0,clients,ADDNAN',
-                'CDEF:d=clients,UN,maxc,UN,1,maxc,IF,*',
+                'CDEF:c=0.5,clients,ADDNAN,FLOOR',
+                'CDEF:d=upstate,UN,1,upstate,IF,0,EQ,maxc,UN,1,maxc,IF,1,MAX,*',
                 'AREA:c#0F0:up\\l',
                 'AREA:d#F00:down\\l',
                 'LINE1:c#00F:clients connected\\l']
diff --git a/lib/rrddb.py b/lib/rrddb.py
index 84fc82aac23fdf43e4310e4815b1bce3e35f3877..a5ef155a74dfc140a7da5933d6e5f99303771f9f 100644
--- a/lib/rrddb.py
+++ b/lib/rrddb.py
@@ -10,8 +10,8 @@ class RRD(object):
     def __init__(self,
                  database_directory,
                  image_path,
-                 display_time_global="7d",
-                 display_time_node="1d"):
+                 display_time_global="14d",
+                 display_time_node="7d"):
 
         self.dbPath = database_directory
         self.globalDb = GlobalRRD(self.dbPath)
